# File Processing Supervisor

This directory contains the file processing supervisor agent for the MOSAIC platform. The file processing supervisor orchestrates file processing by determining the file type and routing processing to specialized agents.

## Overview

The `FileProcessingSupervisor` is a supervisor agent that coordinates file processing across multiple specialized agents. It acts as a central hub for file processing, determining the appropriate agent to handle each file type and ensuring that the results are properly returned to the user.

## Architecture

The file processing supervisor is built on top of the LangGraph framework, which provides a flexible and extensible way to create multi-agent workflows. The supervisor is defined in `file_processing_supervisor.py`.

### Components

The file processing supervisor consists of the following components:

- **StateGraph**: A directed graph that defines the flow of control between agents
- **Nodes**: Represent the different agents involved in file processing
- **Edges**: Define the transitions between agents based on conditions
- **Tools**: Special functions that allow the supervisor to transfer control to specialized agents

### Agent Relationships

The file processing supervisor has relationships with the following specialized agents:

- **FileProcessingAgent**: Handles Excel (XLSX) files, extracting and analyzing tabular data

In the future, additional specialized agents will be added to handle other file types.

## Implementation

### Supervisor Creation

The supervisor is created using the `create_file_processing_supervisor` function, which:

1. Ensures that all required specialized agents are registered
2. Creates a prompt that instructs the supervisor on how to handle file processing
3. Creates a StateGraph that defines the flow of control between agents
4. Compiles the StateGraph into an executable workflow

### Prompt Design

The supervisor's prompt is carefully designed to:

1. Explain the supervisor's role in coordinating file processing
2. Describe the capabilities of each specialized agent
3. Provide clear instructions on when to transfer control to specialized agents
4. Emphasize the importance of including the full results from specialized agents in the response to the user

The prompt includes specific instructions for handling file attachments, ensuring that the supervisor immediately transfers control to the appropriate specialized agent when a file is detected.

### Control Flow

The control flow of the file processing supervisor works as follows:

1. The supervisor receives a message from the user
2. If the message contains a file attachment or mentions a file, the supervisor transfers control to the appropriate specialized agent
3. The specialized agent processes the file and returns the results
4. The supervisor includes the full results in its response to the user

This control flow is implemented using the LangGraph framework, which provides a declarative way to define the transitions between agents.

## Tools

The file processing supervisor provides the following tools (automatically generated by the LangGraph framework):

- **transfer_to_file_processing**: Transfers control to the `FileProcessingAgent` for processing Excel files
- **transfer_back_to_file_processing_supervisor**: Transfers control back to the supervisor after processing

These tools are used to implement the control flow between the supervisor and specialized agents.

## File Type Detection

The supervisor detects file types based on:

- **File Extension**: The supervisor checks the file extension (e.g., .xlsx, .csv) to determine the file type
- **MIME Type**: The supervisor checks the MIME type (e.g., application/vnd.openxmlformats-officedocument.spreadsheetml.sheet) to determine the file type
- **Content Indicators**: The supervisor looks for indicators in the message content (e.g., "[Attached Excel file:") to determine the file type

Based on the detected file type, the supervisor routes the processing to the appropriate specialized agent.

## Message Handling

The supervisor handles messages in the following way:

1. **Message Reception**: The supervisor receives a message from the user
2. **Attachment Detection**: The supervisor checks if the message contains a file attachment
3. **File Type Detection**: The supervisor determines the file type based on the attachment metadata
4. **Agent Selection**: The supervisor selects the appropriate specialized agent based on the file type
5. **Control Transfer**: The supervisor transfers control to the selected agent
6. **Result Reception**: The supervisor receives the results from the specialized agent
7. **Response Generation**: The supervisor includes the full results in its response to the user

This message handling flow ensures that files are processed by the appropriate specialized agents and that the results are properly returned to the user.

## Error Handling

The supervisor includes error handling to deal with various issues that may arise during file processing:

- **Unsupported File Types**: The supervisor provides clear error messages if the file type is not supported
- **Processing Errors**: The supervisor catches and logs exceptions during file processing
- **Agent Unavailability**: The supervisor handles cases where a specialized agent is not available

## Logging

The supervisor includes detailed logging to help diagnose issues:

- **Message Reception**: Logs information about received messages
- **File Detection**: Logs information about detected files
- **Agent Selection**: Logs information about selected agents
- **Control Transfer**: Logs information about control transfers between agents
- **Result Reception**: Logs information about received results
- **Error Handling**: Logs detailed information about errors that occur during processing

## Adding Support for New File Types

To add support for a new file type:

1. **Create a New Agent**: Create a new specialized agent that handles the file type (e.g., `PDFProcessingAgent`)
2. **Register Agent**: Register the new agent with the agent registry
3. **Update Supervisor**: Update the supervisor's prompt to include information about the new agent and when to transfer control to it

The modular design of the file processing system makes it easy to extend with support for additional file types while maintaining a consistent user experience.

## Example Usage

To process an Excel file:

1. Upload an Excel file through the chat interface
2. The supervisor will detect the file and transfer control to the `FileProcessingAgent`
3. The `FileProcessingAgent` will process the file and return the results
4. The supervisor will include the full results in its response to the user

## Future Enhancements

Planned enhancements for the file processing supervisor include:

- **Multi-Agent Orchestration**: Enhance the supervisor to orchestrate multiple specialized agents for complex file processing tasks
- **File Type Inference**: Improve the supervisor's ability to infer file types from content when metadata is not available
- **Processing Pipelines**: Implement processing pipelines that involve multiple specialized agents working together
- **User Preference Learning**: Enable the supervisor to learn user preferences for file processing
- **Result Summarization**: Add the ability to summarize results from specialized agents when appropriate
